<?xml version="1.0" encoding="utf-8"?>
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:Heather.ViewModels"
        xmlns:controls="clr-namespace:Heather.Controls;assembly=Heather"
        x:Class="Heather.MainWindow"
        Title="Heather — Advanced Weather"
        Width="1200" Height="800"
        MinWidth="800" MinHeight="600"
        WindowStartupLocation="CenterScreen"
        CanResize="True">

  <Design.DataContext>
    <vm:MainWindowViewModel/>
  </Design.DataContext>

  <Grid>
    <!-- Animated Background with Particles -->
    <Canvas x:Name="ParticleCanvas" ClipToBounds="True">
      <!-- Animated gradient background -->
      <Rectangle Width="{Binding $parent[Window].Bounds.Width}" 
                 Height="{Binding $parent[Window].Bounds.Height}"
                 Fill="{StaticResource PrimaryGradient}"/>
    </Canvas>
    
    <!-- Main Content with Glass Morphism -->
    <ScrollViewer Padding="24" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
      <StackPanel Spacing="24" MaxWidth="1000" HorizontalAlignment="Center">
        
        <!-- Title Bar with Custom Controls -->
        <Grid ColumnDefinitions="*,Auto" Margin="0,8,0,0">
          <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
            <controls:WeatherSvgIcon IconType="sun" Width="32" Height="32"/>
            <TextBlock Text="Heather" Classes="title" VerticalAlignment="Center"/>
          </StackPanel>
          
          <!-- Window Controls -->
          <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
            <Button Content="−" Width="32" Height="32" Classes="modern" FontSize="16" Padding="0"/>
            <Button Content="□" Width="32" Height="32" Classes="modern" FontSize="12" Padding="0"/>
            <Button Content="×" Width="32" Height="32" Classes="modern" FontSize="16" Padding="0"/>
          </StackPanel>
        </Grid>

        <!-- Advanced Search Section -->
        <Border Classes="glass-card" Padding="24">
          <StackPanel Spacing="16">
            <TextBlock Text="Search Location" Classes="subtitle"/>
            
            <Grid ColumnDefinitions="*,Auto,Auto,Auto,Auto" ColumnGap="12">
              <TextBox Grid.Column="0" 
                       Classes="modern"
                       Watermark="Enter city, ZIP code, or coordinates..." 
                       Text="{Binding Query, Mode=TwoWay}" 
                       TabIndex="1" />
              
              <Button Grid.Column="1" 
                      Content="🔍 Search" 
                      Classes="modern"
                      Command="{Binding SearchCommand}" 
                      TabIndex="2" />

              <!-- Days Selector with Modern Design -->
              <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                <TextBlock Text="Forecast:" Classes="caption" VerticalAlignment="Center"/>
                <ComboBox Classes="modern"
                          ItemsSource="{Binding DaysOptions}" 
                          SelectedItem="{Binding SelectedDays, Mode=TwoWay}" 
                          Width="80" 
                          TabIndex="3" />
                <TextBlock Text="days" Classes="caption" VerticalAlignment="Center"/>
              </StackPanel>

              <!-- Advanced Unit Toggle -->
              <Border Grid.Column="3" 
                      Background="{StaticResource CardBackground}"
                      CornerRadius="12"
                      BorderBrush="{StaticResource GlassOverlay}"
                      BorderThickness="1">
                <ToggleButton Content="{Binding UnitToggleText}"
                              IsChecked="{Binding UseFahrenheit, Mode=TwoWay}"
                              Command="{Binding ToggleUnitsCommand}"
                              Padding="16,8"
                              Background="Transparent"
                              BorderThickness="0"
                              Foreground="{StaticResource TextPrimary}"
                              TabIndex="4"/>
              </Border>
              
              <!-- Settings Button -->
              <Button Grid.Column="4" 
                      Content="⚙️" 
                      Classes="modern"
                      Width="44" 
                      Height="44"
                      FontSize="16"
                      TabIndex="5"/>
            </Grid>
          </StackPanel>
        </Border>

        <!-- Hero Weather Card with Advanced Animations -->
        <Border Classes="glass-card" Padding="32" MinHeight="300">
          <Grid ColumnDefinitions="*,Auto,*" RowDefinitions="Auto,*,Auto">
            
            <!-- Location and Time -->
            <StackPanel Grid.Column="0" Grid.Row="0" Spacing="8">
              <TextBlock Text="{Binding LocationName}" Classes="subtitle"/>
              <TextBlock Text="{Binding LocalTime}" Classes="caption"/>
              <TextBlock Text="{Binding Current.ConditionText}" Classes="caption" FontStyle="Italic"/>
            </StackPanel>
            
            <!-- Weather Status Indicators -->
            <StackPanel Grid.Column="2" Grid.Row="0" HorizontalAlignment="Right" Spacing="4">
              <Border Background="{StaticResource AccentGradient}" 
                      CornerRadius="12" 
                      Padding="8,4">
                <TextBlock Text="{Binding Current.IsDayText}" 
                           Foreground="White" 
                           FontSize="12" 
                           FontWeight="Medium"/>
              </Border>
              <TextBlock Text="🌡️ Real Feel" Classes="caption"/>
              <TextBlock Text="{Binding Current.FeelsLikeFormatted}" 
                         Classes="caption" 
                         FontWeight="Medium"/>
            </StackPanel>

            <!-- Main Temperature Display -->
            <StackPanel Grid.Column="1" Grid.Row="1" 
                        HorizontalAlignment="Center" 
                        VerticalAlignment="Center"
                        Spacing="16">
              
              <!-- Animated Weather Icon -->
              <Border Background="{StaticResource GlassOverlay}"
                      CornerRadius="50"
                      Width="100" Height="100"
                      HorizontalAlignment="Center">
                <controls:WeatherSvgIcon IconType="{Binding Current.ConditionText}" 
                                         Width="64" Height="64"
                                         HorizontalAlignment="Center"
                                         VerticalAlignment="Center"/>
              </Border>
              
              <!-- Temperature with Gradient Text Effect -->
              <TextBlock Text="{Binding Current.TemperatureFormatted}" 
                         Classes="temperature"
                         HorizontalAlignment="Center"
                         Foreground="{StaticResource AccentGradient}"/>
            </StackPanel>

            <!-- Advanced Weather Metrics Grid -->
            <Grid Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="2" 
                  ColumnDefinitions="*,*,*,*" 
                  RowDefinitions="Auto,Auto" 
                  ColumnGap="24" 
                  RowGap="16"
                  Margin="0,24,0,0">
              
              <!-- Wind Information -->
              <Border Grid.Column="0" Grid.Row="0" Classes="glass-card" Padding="16">
                <StackPanel Spacing="8">
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="💨" FontSize="16"/>
                    <TextBlock Text="Wind" Classes="caption" FontWeight="Medium"/>
                  </StackPanel>
                  <TextBlock Text="{Binding Current.WindText}" Classes="subtitle" FontSize="14"/>
                  <TextBlock Text="{Binding Current.GustText}" Classes="caption"/>
                </StackPanel>
              </Border>
              
              <!-- Humidity -->
              <Border Grid.Column="1" Grid.Row="0" Classes="glass-card" Padding="16">
                <StackPanel Spacing="8">
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="💧" FontSize="16"/>
                    <TextBlock Text="Humidity" Classes="caption" FontWeight="Medium"/>
                  </StackPanel>
                  <StackPanel Orientation="Horizontal" Spacing="4">
                    <TextBlock Text="{Binding Current.Humidity}" Classes="subtitle" FontSize="14"/>
                    <TextBlock Text="%" Classes="subtitle" FontSize="14"/>
                  </StackPanel>
                  <ProgressBar Value="{Binding Current.Humidity}" 
                               Maximum="100" 
                               Classes="modern"/>
                </StackPanel>
              </Border>
              
              <!-- Cloud Cover -->
              <Border Grid.Column="2" Grid.Row="0" Classes="glass-card" Padding="16">
                <StackPanel Spacing="8">
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="☁️" FontSize="16"/>
                    <TextBlock Text="Clouds" Classes="caption" FontWeight="Medium"/>
                  </StackPanel>
                  <StackPanel Orientation="Horizontal" Spacing="4">
                    <TextBlock Text="{Binding Current.Cloud}" Classes="subtitle" FontSize="14"/>
                    <TextBlock Text="%" Classes="subtitle" FontSize="14"/>
                  </StackPanel>
                  <ProgressBar Value="{Binding Current.Cloud}" 
                               Maximum="100" 
                               Classes="modern"/>
                </StackPanel>
              </Border>
              
              <!-- Precipitation -->
              <Border Grid.Column="3" Grid.Row="0" Classes="glass-card" Padding="16">
                <StackPanel Spacing="8">
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="🌧️" FontSize="16"/>
                    <TextBlock Text="Precipitation" Classes="caption" FontWeight="Medium"/>
                  </StackPanel>
                  <TextBlock Text="{Binding Current.PrecipText}" Classes="subtitle" FontSize="14"/>
                </StackPanel>
              </Border>
              
              <!-- Dew Point -->
              <Border Grid.Column="0" Grid.Row="1" Classes="glass-card" Padding="16">
                <StackPanel Spacing="8">
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="🌡️" FontSize="16"/>
                    <TextBlock Text="Dew Point" Classes="caption" FontWeight="Medium"/>
                  </StackPanel>
                  <TextBlock Text="{Binding Current.DewpointText}" Classes="subtitle" FontSize="14"/>
                </StackPanel>
              </Border>
              
              <!-- UV Index Placeholder -->
              <Border Grid.Column="1" Grid.Row="1" Classes="glass-card" Padding="16">
                <StackPanel Spacing="8">
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="☀️" FontSize="16"/>
                    <TextBlock Text="UV Index" Classes="caption" FontWeight="Medium"/>
                  </StackPanel>
                  <TextBlock Text="Moderate" Classes="subtitle" FontSize="14"/>
                  <ProgressBar Value="5" Maximum="11" Classes="modern"/>
                </StackPanel>
              </Border>
              
              <!-- Visibility -->
              <Border Grid.Column="2" Grid.Row="1" Classes="glass-card" Padding="16">
                <StackPanel Spacing="8">
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="👁️" FontSize="16"/>
                    <TextBlock Text="Visibility" Classes="caption" FontWeight="Medium"/>
                  </StackPanel>
                  <TextBlock Text="10+ km" Classes="subtitle" FontSize="14"/>
                </StackPanel>
              </Border>
              
              <!-- Air Quality -->
              <Border Grid.Column="3" Grid.Row="1" Classes="glass-card" Padding="16">
                <StackPanel Spacing="8">
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="🍃" FontSize="16"/>
                    <TextBlock Text="Air Quality" Classes="caption" FontWeight="Medium"/>
                  </StackPanel>
                  <TextBlock Text="Good" Classes="subtitle" FontSize="14"/>
                  <Border Background="#4ADE80" CornerRadius="4" Width="40" Height="4"/>
                </StackPanel>
              </Border>
            </Grid>
          </Grid>
        </Border>

        <!-- Advanced Forecast Section -->
        <Border Classes="glass-card" Padding="24">
          <StackPanel Spacing="20">
            <StackPanel Orientation="Horizontal" Spacing="12">
              <TextBlock Text="📅" FontSize="20"/>
              <TextBlock Text="Extended Forecast" Classes="subtitle"/>
              <TextBlock Text="{Binding SelectedDays}" Classes="caption"/>
              <TextBlock Text="day forecast" Classes="caption"/>
            </StackPanel>
            
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
              <ItemsControl ItemsSource="{Binding ForecastDays}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Border Classes="glass-card" 
                            Margin="0,0,16,0" 
                            Padding="20" 
                            Width="280"
                            MinHeight="320">
                      <StackPanel Spacing="16">
                        
                        <!-- Date Header -->
                        <Border Background="{StaticResource AccentGradient}" 
                                CornerRadius="8" 
                                Padding="12,6">
                          <TextBlock Text="{Binding DateReadable}" 
                                     Foreground="White" 
                                     FontWeight="Medium"
                                     HorizontalAlignment="Center"/>
                        </Border>
                        
                        <!-- Weather Icon and Condition -->
                        <StackPanel HorizontalAlignment="Center" Spacing="12">
                          <Border Background="{StaticResource GlassOverlay}"
                                  CornerRadius="30"
                                  Width="60" Height="60"
                                  HorizontalAlignment="Center">
                            <controls:WeatherSvgIcon IconType="{Binding Condition}" 
                                                     Width="36" Height="36"
                                                     HorizontalAlignment="Center"
                                                     VerticalAlignment="Center"/>
                          </Border>
                          <TextBlock Text="{Binding Condition}" 
                                     Classes="caption" 
                                     HorizontalAlignment="Center"
                                     TextWrapping="Wrap"
                                     MaxWidth="200"/>
                        </StackPanel>
                        
                        <!-- Temperature Range -->
                        <Grid ColumnDefinitions="*,Auto,*" ColumnGap="8">
                          <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                            <TextBlock Text="High" Classes="caption" HorizontalAlignment="Center"/>
                            <TextBlock Text="{Binding MaxTempFormatted}" 
                                       Classes="subtitle" 
                                       FontSize="18"
                                       HorizontalAlignment="Center"/>
                          </StackPanel>
                          
                          <Rectangle Grid.Column="1" Width="1" Height="40" Fill="{StaticResource GlassOverlay}"/>
                          
                          <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                            <TextBlock Text="Low" Classes="caption" HorizontalAlignment="Center"/>
                            <TextBlock Text="{Binding MinTempFormatted}" 
                                       Classes="subtitle" 
                                       FontSize="18"
                                       HorizontalAlignment="Center"/>
                          </StackPanel>
                        </Grid>
                        
                        <!-- Precipitation Chance -->
                        <StackPanel Spacing="8">
                          <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="🌧️" FontSize="14"/>
                            <TextBlock Text="Precipitation" Classes="caption"/>
                          </StackPanel>
                          <StackPanel Orientation="Horizontal" Spacing="4">
                            <TextBlock Text="{Binding ChanceOfPrecip}" Classes="subtitle" FontSize="14"/>
                            <TextBlock Text="%" Classes="subtitle" FontSize="14"/>
                          </StackPanel>
                          <ProgressBar Value="{Binding ChanceOfPrecip}" 
                                       Maximum="100" 
                                       Classes="modern"/>
                        </StackPanel>
                        
                        <!-- Astronomical Data -->
                        <StackPanel Spacing="12">
                          <TextBlock Text="🌅 Astronomical Data" Classes="caption" FontWeight="Medium"/>
                          
                          <Grid ColumnDefinitions="*,*" ColumnGap="16" RowGap="8">
                            <StackPanel Grid.Column="0" Grid.Row="0">
                              <TextBlock Text="Sunrise" Classes="caption"/>
                              <TextBlock Text="{Binding Sunrise}" FontSize="12" Foreground="{StaticResource TextPrimary}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Grid.Row="0">
                              <TextBlock Text="Sunset" Classes="caption"/>
                              <TextBlock Text="{Binding Sunset}" FontSize="12" Foreground="{StaticResource TextPrimary}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="0" Grid.Row="1">
                              <TextBlock Text="Moonrise" Classes="caption"/>
                              <TextBlock Text="{Binding Moonrise}" FontSize="12" Foreground="{StaticResource TextPrimary}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Grid.Row="1">
                              <TextBlock Text="Moonset" Classes="caption"/>
                              <TextBlock Text="{Binding Moonset}" FontSize="12" Foreground="{StaticResource TextPrimary}"/>
                            </StackPanel>
                          </Grid>
                          
                          <StackPanel Spacing="4">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                              <TextBlock Text="🌙" FontSize="14"/>
                              <TextBlock Text="{Binding MoonPhase}" Classes="caption"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="4">
                              <TextBlock Text="Illumination:" Classes="caption"/>
                              <TextBlock Text="{Binding MoonIllumination}" Classes="caption" FontWeight="Medium"/>
                              <TextBlock Text="%" Classes="caption"/>
                            </StackPanel>
                          </StackPanel>
                        </StackPanel>
                      </StackPanel>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <StackPanel Orientation="Horizontal" />
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
              </ItemsControl>
            </ScrollViewer>
          </StackPanel>
        </Border>
      </StackPanel>
    </ScrollViewer>

    <!-- Advanced Error Banner -->
    <Border Background="#DC2626" 
            CornerRadius="12" 
            Padding="16" 
            Margin="24,24,24,0"
            IsVisible="{Binding HasError}"
            VerticalAlignment="Top"
            BoxShadow="0 4 16 0 #40DC2626">
      <StackPanel Orientation="Horizontal" Spacing="12">
        <TextBlock Text="⚠️" FontSize="16"/>
        <TextBlock Text="{Binding ErrorMessage}" 
                   Foreground="White" 
                   FontWeight="Medium"
                   TextWrapping="Wrap"/>
      </StackPanel>
    </Border>

    <!-- Advanced Loading Overlay -->
    <Border Background="#80000000" 
            IsVisible="{Binding IsLoading}"
            ClipToBounds="True">
      <Grid>
        <!-- Animated Background -->
        <Rectangle Fill="{StaticResource PrimaryGradient}" Opacity="0.9"/>
        
        <!-- Loading Content -->
        <StackPanel HorizontalAlignment="Center" 
                    VerticalAlignment="Center"
                    Spacing="24">
          
          <!-- Animated Weather Icon -->
          <Border Background="{StaticResource GlassOverlay}"
                  CornerRadius="40"
                  Width="80" Height="80"
                  HorizontalAlignment="Center">
            <controls:WeatherSvgIcon IconType="sun" 
                                     Width="48" Height="48"
                                     HorizontalAlignment="Center"
                                     VerticalAlignment="Center"/>
          </Border>
          
          <!-- Progress Bar -->
          <ProgressBar Width="300" 
                       Height="8"
                       IsIndeterminate="True" 
                       Classes="modern"/>
          
          <!-- Loading Text -->
          <StackPanel Spacing="8" HorizontalAlignment="Center">
            <TextBlock Text="Fetching Weather Data..." 
                       Foreground="White" 
                       FontSize="18"
                       FontWeight="Medium"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="Please wait while we gather the latest conditions" 
                       Classes="caption"
                       HorizontalAlignment="Center"/>
          </StackPanel>
        </StackPanel>
      </Grid>
    </Border>

    <!-- Highlight Overlay for Transitions -->
    <Border Background="#10FFFFFF" 
            Opacity="{Binding HighlightOpacity}" 
            IsHitTestVisible="False" />
  </Grid>
</Window>